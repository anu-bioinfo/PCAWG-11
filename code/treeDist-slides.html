<!DOCTYPE html>
<head>
<meta charset="utf-8">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
<style>
  html { background-color: black; }
  body { background-color: white; border-radius: 12px}
  /* A section is a slide. It's size is 800x600, and this will never change */
  section {
      font-family: Arial, serif;
      font-size: 20pt;
    }
  address, blockquote, dl, fieldset, form, h1, h2, h3, h4, h5, h6, hr, ol, p, pre, table, ul, dl { padding: 10px 20px 10px 20px; }
  h1, h2, h3 {
    text-align: center;
    margin: 10pt 10pt 20pt 10pt;
  }
  ul, ol {
    margin: 10px 10px 10px 50px;
  }
  section.titleslide h1 { margin-top: 200px; }
  h1.title { margin-top: 150px; }
  h1 { font-size: 180%; }
  h2 { font-size: 120%; }
  h3 { font-size: 100%; }
  q { quotes: "“" "”" "‘" "’"; }
  blockquote { font-style: italic }
  /* Figures are displayed full-page, with the caption on
     top of the image/video */
  figure {
    background-color: black;
  }
  figcaption {
    margin: 70px;
  }
  footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 40px;
    text-align: right;
    background-color: #F3F4F8;
    border-top: 1px solid #CCC;
  }

  /* Transition effect */
  /* Feel free to change the transition effect for original
     animations. See here:
     https://developer.mozilla.org/en/CSS/CSS_transitions
     How to use CSS3 Transitions: */
  section {
      -moz-transition: left 400ms linear 0s;
      -webkit-transition: left 400ms linear 0s;
      -ms-transition: left 400ms linear 0s;
      transition: left 400ms linear 0s;
  }

  /* Before */
  section { left: -150%; }
  /* Now */
  section[aria-selected] { left: 0; }
  /* After */
  section[aria-selected] ~ section { left: +150%; }

  /* Incremental elements */

  /* By default, visible */
  .incremental > * { opacity: 1; }

  /* The current item */
  .incremental > *[aria-selected] { color: red; opacity: 1; }

  /* The items to-be-selected */
  .incremental > *[aria-selected] ~ * { opacity: 0.2; }
</style>
</head>
<body>
<section id="tree-distance" class="slide level1">
<h1>Tree distance</h1>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(igraph)
<span class="kw">library</span>(CoxHD)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">toTree &lt;-<span class="st"> </span>function(edgelist, branch.length, labels){
    g &lt;-<span class="st"> </span><span class="kw">graph.edgelist</span>(edgelist)
    o &lt;-<span class="st"> </span><span class="kw">order</span>(<span class="kw">get.edgelist</span>(g)[,<span class="dv">2</span>])
    <span class="kw">E</span>(g)$weight[o] &lt;-<span class="st"> </span>branch.length
    <span class="kw">E</span>(g)$name[o] &lt;-<span class="st"> </span>labels
    <span class="kw">return</span>(g)   
}

toPhylo &lt;-<span class="st"> </span>function(edge, edge.length, labels){
    edge &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(edge)
    <span class="kw">dimnames</span>(edge) &lt;-<span class="st"> </span><span class="ot">NULL</span>
    all &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">c</span>(edge[,<span class="dv">1</span>], edge[,<span class="dv">2</span>]))
    tips &lt;-<span class="st"> </span><span class="kw">setdiff</span>(edge[,<span class="dv">2</span>],edge[,<span class="dv">1</span>])
    nodes &lt;-<span class="st"> </span><span class="kw">setdiff</span>(all, tips)
    order &lt;-<span class="st"> </span><span class="kw">c</span>(tips, nodes)
    o &lt;-<span class="st"> </span><span class="kw">order</span>(order)
    l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">edge=</span><span class="kw">cbind</span>(o[edge[,<span class="dv">1</span>]],o[edge[,<span class="dv">2</span>]]), <span class="dt">edge.length=</span>edge.length, <span class="dt">Nnode=</span><span class="kw">length</span>(nodes), <span class="dt">tip.label=</span>labels[tips], <span class="dt">node.labels=</span>labels[nodes])
    <span class="kw">class</span>(l) &lt;-<span class="st"> &quot;phylo&quot;</span>
    <span class="kw">attr</span>(l, <span class="st">&quot;order&quot;</span>) &lt;-<span class="st"> &quot;cladewise&quot;</span>
    <span class="kw">return</span>(l)
}

<span class="co">#tree &lt;- list(`1`=2,`2`=c(3,4),`3`=5:7)</span></code></pre>
</section>
<section id="read-data" class="slide level1">
<h1>Read data</h1>
<pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;BRCA.txt&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)
<span class="kw">kable</span>(data)</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Sample</th>
<th style="text-align: right;">Parent</th>
<th style="text-align: right;">Child</th>
<th style="text-align: left;">Annotation</th>
<th style="text-align: right;">Length</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PD9775</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">3104</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9775</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9773</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53;ARID1B</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">2036</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9773</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9776</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">PTEN;ARID1B;MYC;FGFR2;17p-;BRCA1</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">13219</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9776</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">MYC</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9776</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9777</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53;CBL;JAK2;17p-</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">4851</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9777</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9777</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">FGFR2;MYC</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9777</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">FGFR2</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9777</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9769</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53;CTNNB1;PTEN;MYC;CCNE1;17p-</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">6582</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9769</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">RUNX1</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9769</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9769</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">IGF2R;RUNX1</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9771</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53;FGFR1;WHSC1L1;ERLIN2;IGF1R;CDK4;AR;MET;17p-</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">11479</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9771</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NRAS;CDKN2B</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9771</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">CIC</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9771</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">RAD21;NCOR</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9771</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9771</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9770</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53;PIK3CA;EGFR</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">7624</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9770</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">EGFR;NRG1;CDC7</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9770</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">CDK6;CUX1;3p-</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9770</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">CUX1</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9770</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">ERBB2</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9849</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53;PTEN;FGFR2;ERLIN2;WHSC1L1;FGFR1;17p-</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">4212</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9849</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">CBFB</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9849</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9849</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9852</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">TP53;PIK3CA;PBRM1;NF1;EGFR;ERBB2;17p-</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">6231</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9852</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9852</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">PBRM1</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9694</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">SF3B1;CREBBP;PTEN</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">3371</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9694</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">BMX;FGFR1;AKT3</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9694</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">PTEN</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9694</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PD9694</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">TERT</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">PD9694</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
<p>Split</p>
<pre class="sourceCode r"><code class="sourceCode r">dataList &lt;-<span class="st"> </span><span class="kw">split</span>(data, data$Sample)</code></pre>
</section>
<section id="create-tree-structurs" class="slide level1">
<h1>Create tree structurs</h1>
<pre class="sourceCode r"><code class="sourceCode r">allTrees &lt;-<span class="st"> </span><span class="kw">lapply</span>(dataList, function(x){   
            <span class="kw">toTree</span>(<span class="kw">as.matrix</span>(x[,<span class="kw">c</span>(<span class="st">&quot;Parent&quot;</span>,<span class="st">&quot;Child&quot;</span>)])+<span class="dv">1</span>, <span class="dt">branch.length =</span> x$Length, <span class="dt">labels=</span><span class="kw">as.character</span>(x$Annotation))
})
<span class="kw">names</span>(allTrees) &lt;-<span class="st"> </span><span class="kw">names</span>(dataList)
i &lt;-<span class="st"> </span><span class="dv">1</span>; for(tree in allTrees){
    <span class="kw">plot</span>(tree, <span class="dt">layout=</span><span class="kw">layout.reingold.tilford</span>(tree), <span class="dt">main=</span><span class="kw">names</span>(allTrees)[i], <span class="dt">edge.label=</span><span class="kw">E</span>(tree)$name); i&lt;-i<span class="dv">+1</span>}</code></pre>
<p><img src="figure/trees1.png" alt="plot of chunk trees" /> <img src="figure/trees2.png" alt="plot of chunk trees" /> <img src="figure/trees3.png" alt="plot of chunk trees" /> <img src="figure/trees4.png" alt="plot of chunk trees" /> <img src="figure/trees5.png" alt="plot of chunk trees" /> <img src="figure/trees6.png" alt="plot of chunk trees" /> <img src="figure/trees7.png" alt="plot of chunk trees" /> <img src="figure/trees8.png" alt="plot of chunk trees" /> <img src="figure/trees9.png" alt="plot of chunk trees" /> <img src="figure/trees10.png" alt="plot of chunk trees" /></p>
</section>
<section id="compute-distance-of-nodes" class="slide level1">
<h1>Compute distance of nodes</h1>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shortest.paths</span>(allTrees$PD9694, <span class="dt">mode=</span><span class="st">&quot;out&quot;</span>) <span class="co"># example</span></code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
## [1,]    0  0.2  0.6  1.0  0.7  0.4  1.0
## [2,]  Inf  0.0  0.4  0.8  0.5  0.2  0.8
## [3,]  Inf  Inf  0.0  0.4  0.1  Inf  Inf
## [4,]  Inf  Inf  Inf  0.0  Inf  Inf  Inf
## [5,]  Inf  Inf  Inf  Inf  0.0  Inf  Inf
## [6,]  Inf  Inf  Inf  Inf  Inf  0.0  0.6
## [7,]  Inf  Inf  Inf  Inf  Inf  Inf  0.0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">allDist &lt;-<span class="st"> </span><span class="kw">sapply</span>(allTrees, function(tree){ <span class="co">#all</span>
            e &lt;-<span class="st"> </span><span class="kw">get.edgelist</span>(tree)
            w &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">E</span>(tree)$weight/<span class="dv">2</span>)
            d &lt;-<span class="st"> </span><span class="kw">shortest.paths</span>(tree, <span class="dt">mode=</span><span class="st">&#39;out&#39;</span>) -<span class="st"> </span><span class="kw">rep</span>(w, <span class="dt">each=</span><span class="kw">length</span>(w))
            <span class="kw">diag</span>(d) &lt;-<span class="st"> </span><span class="dv">0</span>
            d
        })</code></pre>
</section>
<section id="get-all-mutations" class="slide level1">
<h1>Get all mutations</h1>
<pre class="sourceCode r"><code class="sourceCode r">u &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">as.character</span>(data$Annotation), <span class="st">&quot;;&quot;</span>))
<span class="kw">table</span>(u)</code></pre>
<pre><code>## u
##    17p-     3p-    AKT3      AR  ARID1B     BMX   BRCA1    CBFB     CBL 
##       6       1       1       1       2       1       1       1       1 
##   CCNE1    CDC7    CDK4    CDK6  CDKN2B     CIC  CREBBP  CTNNB1    CUX1 
##       1       1       1       1       1       1       1       1       2 
##    EGFR   ERBB2  ERLIN2   FGFR1   FGFR2   IGF1R   IGF2R    JAK2     MET 
##       3       2       2       3       4       1       1       1       1 
##     MYC    NCOR     NF1    NRAS    NRG1   PBRM1  PIK3CA    PTEN   RAD21 
##       4       1       1       1       1       2       2       5       1 
##   RUNX1   SF3B1    TERT    TP53 WHSC1L1 
##       2       1       1       8       2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">allMutations &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(u))
allMutationsGermline &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;germline&quot;</span>,allMutations)</code></pre>
</section>
<section id="put-into-large-array" class="slide level1">
<h1>Put into large array</h1>
<pre class="sourceCode r"><code class="sourceCode r">allDistMutations &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">length</span>(allMutationsGermline),<span class="dv">2</span>), <span class="kw">length</span>(dataList)), <span class="dt">dimnames=</span><span class="kw">list</span>(allMutationsGermline, allMutationsGermline, <span class="kw">names</span>(dataList)))
for(n in <span class="kw">names</span>(dataList)){
    m &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">germline=</span><span class="dv">1</span>,<span class="kw">sapply</span>(allMutations, function(x) {g &lt;-<span class="st"> </span><span class="kw">grep</span>(x, dataList[[n]]$Annotation); if(<span class="kw">length</span>(g)==<span class="dv">0</span>) <span class="ot">NA</span> else g[<span class="dv">1</span>]+<span class="dv">1</span>}))
    d &lt;-<span class="st"> </span>allDist[[n]][m,m]
    <span class="co">#d[is.infinite(d)] &lt;- NA</span>
    allDistMutations[,,n] &lt;-<span class="st"> </span>d
}</code></pre>
</section>
<section id="fit-model" class="slide level1">
<h1>Fit model</h1>
<pre class="sourceCode r"><code class="sourceCode r">observed &lt;-<span class="st"> </span>!<span class="kw">is.na</span>(allDistMutations) &amp;<span class="st"> </span>!<span class="kw">is.infinite</span>(allDistMutations)
w &lt;-<span class="st"> </span><span class="kw">which</span>(observed, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span>allDistMutations[observed]
x &lt;-<span class="st"> </span><span class="kw">MakeInteger</span>(<span class="kw">factor</span>(w[,<span class="dv">2</span>], <span class="dt">levels=</span><span class="kw">seq_along</span>(allMutationsGermline), <span class="dt">labels=</span>allMutationsGermline)) -<span class="st"> </span><span class="kw">MakeInteger</span>(<span class="kw">factor</span>(w[,<span class="dv">1</span>], <span class="dt">levels=</span><span class="kw">seq_along</span>(allMutationsGermline), <span class="dt">labels=</span>allMutationsGermline))

fit &lt;-<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>. -<span class="dv">1</span> -germline, <span class="dt">data=</span>x)
s &lt;-<span class="st"> </span><span class="kw">summary</span>(fit)
<span class="kw">kable</span>(s$coefficients)</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">t value</th>
<th style="text-align: right;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>17p-</code></td>
<td style="text-align: right;">0.4455</td>
<td style="text-align: right;">0.0111</td>
<td style="text-align: right;">40.0618</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>3p-</code></td>
<td style="text-align: right;">0.5859</td>
<td style="text-align: right;">0.0269</td>
<td style="text-align: right;">21.7962</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AKT3</td>
<td style="text-align: right;">0.4874</td>
<td style="text-align: right;">0.0279</td>
<td style="text-align: right;">17.4691</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">AR</td>
<td style="text-align: right;">0.4504</td>
<td style="text-align: right;">0.0140</td>
<td style="text-align: right;">32.1718</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ARID1B</td>
<td style="text-align: right;">0.4510</td>
<td style="text-align: right;">0.0187</td>
<td style="text-align: right;">24.1051</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">BMX</td>
<td style="text-align: right;">0.4874</td>
<td style="text-align: right;">0.0279</td>
<td style="text-align: right;">17.4691</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BRCA1</td>
<td style="text-align: right;">0.4516</td>
<td style="text-align: right;">0.0216</td>
<td style="text-align: right;">20.9401</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CBFB</td>
<td style="text-align: right;">0.5281</td>
<td style="text-align: right;">0.0262</td>
<td style="text-align: right;">20.1636</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBL</td>
<td style="text-align: right;">0.4207</td>
<td style="text-align: right;">0.0254</td>
<td style="text-align: right;">16.5693</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCNE1</td>
<td style="text-align: right;">0.4393</td>
<td style="text-align: right;">0.0217</td>
<td style="text-align: right;">20.1992</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDC7</td>
<td style="text-align: right;">0.6403</td>
<td style="text-align: right;">0.0318</td>
<td style="text-align: right;">20.1479</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDK4</td>
<td style="text-align: right;">0.4498</td>
<td style="text-align: right;">0.0177</td>
<td style="text-align: right;">25.4372</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDK6</td>
<td style="text-align: right;">0.5859</td>
<td style="text-align: right;">0.0269</td>
<td style="text-align: right;">21.7962</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDKN2B</td>
<td style="text-align: right;">0.4988</td>
<td style="text-align: right;">0.0224</td>
<td style="text-align: right;">22.2434</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CIC</td>
<td style="text-align: right;">0.5315</td>
<td style="text-align: right;">0.0223</td>
<td style="text-align: right;">23.8308</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CREBBP</td>
<td style="text-align: right;">0.2957</td>
<td style="text-align: right;">0.0268</td>
<td style="text-align: right;">11.0466</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CTNNB1</td>
<td style="text-align: right;">0.4393</td>
<td style="text-align: right;">0.0217</td>
<td style="text-align: right;">20.1992</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">CUX1</td>
<td style="text-align: right;">0.5859</td>
<td style="text-align: right;">0.0269</td>
<td style="text-align: right;">21.7962</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EGFR</td>
<td style="text-align: right;">0.4130</td>
<td style="text-align: right;">0.0176</td>
<td style="text-align: right;">23.4584</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">ERBB2</td>
<td style="text-align: right;">0.5683</td>
<td style="text-align: right;">0.0187</td>
<td style="text-align: right;">30.3658</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ERLIN2</td>
<td style="text-align: right;">0.4499</td>
<td style="text-align: right;">0.0147</td>
<td style="text-align: right;">30.7043</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">FGFR1</td>
<td style="text-align: right;">0.4574</td>
<td style="text-align: right;">0.0137</td>
<td style="text-align: right;">33.4601</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FGFR2</td>
<td style="text-align: right;">0.4685</td>
<td style="text-align: right;">0.0147</td>
<td style="text-align: right;">31.9445</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">IGF1R</td>
<td style="text-align: right;">0.4498</td>
<td style="text-align: right;">0.0177</td>
<td style="text-align: right;">25.4372</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IGF2R</td>
<td style="text-align: right;">0.5774</td>
<td style="text-align: right;">0.0281</td>
<td style="text-align: right;">20.5567</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">JAK2</td>
<td style="text-align: right;">0.4207</td>
<td style="text-align: right;">0.0254</td>
<td style="text-align: right;">16.5693</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MET</td>
<td style="text-align: right;">0.4498</td>
<td style="text-align: right;">0.0177</td>
<td style="text-align: right;">25.4372</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">MYC</td>
<td style="text-align: right;">0.4648</td>
<td style="text-align: right;">0.0150</td>
<td style="text-align: right;">31.0779</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NCOR</td>
<td style="text-align: right;">0.6699</td>
<td style="text-align: right;">0.0217</td>
<td style="text-align: right;">30.8378</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">NF1</td>
<td style="text-align: right;">0.4523</td>
<td style="text-align: right;">0.0221</td>
<td style="text-align: right;">20.4918</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NRAS</td>
<td style="text-align: right;">0.4988</td>
<td style="text-align: right;">0.0224</td>
<td style="text-align: right;">22.2434</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">NRG1</td>
<td style="text-align: right;">0.6403</td>
<td style="text-align: right;">0.0318</td>
<td style="text-align: right;">20.1479</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PBRM1</td>
<td style="text-align: right;">0.4523</td>
<td style="text-align: right;">0.0221</td>
<td style="text-align: right;">20.4918</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">PIK3CA</td>
<td style="text-align: right;">0.4130</td>
<td style="text-align: right;">0.0176</td>
<td style="text-align: right;">23.4584</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PTEN</td>
<td style="text-align: right;">0.4179</td>
<td style="text-align: right;">0.0131</td>
<td style="text-align: right;">32.0019</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">RAD21</td>
<td style="text-align: right;">0.6699</td>
<td style="text-align: right;">0.0217</td>
<td style="text-align: right;">30.8378</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RUNX1</td>
<td style="text-align: right;">0.5774</td>
<td style="text-align: right;">0.0281</td>
<td style="text-align: right;">20.5567</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">SF3B1</td>
<td style="text-align: right;">0.2957</td>
<td style="text-align: right;">0.0268</td>
<td style="text-align: right;">11.0466</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TERT</td>
<td style="text-align: right;">0.4023</td>
<td style="text-align: right;">0.0374</td>
<td style="text-align: right;">10.7661</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">TP53</td>
<td style="text-align: right;">0.4353</td>
<td style="text-align: right;">0.0108</td>
<td style="text-align: right;">40.1339</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WHSC1L1</td>
<td style="text-align: right;">0.4499</td>
<td style="text-align: right;">0.0147</td>
<td style="text-align: right;">30.7043</td>
<td style="text-align: right;">0.0000</td>
</tr>
</tbody>
</table>
</section>
<section id="plot" class="slide level1">
<h1>Plot</h1>
<pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span><span class="kw">rank</span>(<span class="kw">coef</span>(fit), <span class="dt">ties.method =</span> <span class="st">&#39;random&#39;</span>)
c &lt;-<span class="st"> </span><span class="kw">coef</span>(fit)
<span class="kw">par</span>(<span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">xpd=</span><span class="ot">NA</span>)
<span class="kw">plot</span>(c, r, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">xlab=</span><span class="st">&quot;relative time&quot;</span>, <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>)
v1 &lt;-<span class="st"> </span>s$coefficients[,<span class="dv">2</span>]^<span class="dv">2</span>
d1 &lt;-<span class="st"> </span><span class="kw">colSums</span>(<span class="kw">abs</span>(x[,-<span class="dv">1</span>]))
d0 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># prior df</span>
v0 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># prior variance, i.e., any time</span>
v &lt;-<span class="st"> </span>(d1*v1 +<span class="st"> </span>d0 *<span class="st"> </span>v0)/(d0+d1)  
sd &lt;-<span class="st"> </span><span class="kw">sqrt</span>(v)
<span class="kw">segments</span>(c-sd,r, c+sd,r)
<span class="kw">text</span>(c+sd,r,<span class="kw">names</span>(c), <span class="dt">pos=</span><span class="dv">4</span>)</code></pre>
<figure>
<img src="figure/unnamed-chunk-5.png" alt="plot of chunk unnamed-chunk-5" /><figcaption>plot of chunk unnamed-chunk-5</figcaption>
</figure>
</section>
<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :€
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<div id="progress-bar"></div>

<!-- Default Style -->
<style>
  * { margin: 0; padding: 0; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
  details { display: none; }
  body {
    width: 800px; height: 600px;
    margin-left: -400px; margin-top: -300px;
    position: absolute; top: 50%; left: 50%;
    overflow: hidden;
  }
  section {
    position: absolute;
    pointer-events: none;
    width: 100%; height: 100%;
  }
  section[aria-selected] { pointer-events: auto; }
  html { overflow: hidden; }
  body { display: none; }
  body.loaded { display: block; }
  .incremental {visibility: hidden; }
  .incremental[active] {visibility: visible; }
  #progress-bar{
    bottom: 0;
    position: absolute;
    -moz-transition: width 400ms linear 0s;
    -webkit-transition: width 400ms linear 0s;
    -ms-transition: width 400ms linear 0s;
    transition: width 400ms linear 0s;
  }
  figure {
    width: 100%;
    height: 100%;
  }
  figure > * {
    position: absolute;
  }
  figure > img, figure > video {
    width: 100%; height: 100%;
  }
</style>

<script>
  var Dz = {
    remoteWindows: [],
    idx: -1,
    step: 0,
    slides: null,
    progressBar : null,
    params: {
      autoplay: "1"
    }
  };

  Dz.init = function() {
    document.body.className = "loaded";
    this.slides = $$("body > section");
    this.progressBar = $("#progress-bar");
    this.setupParams();
    this.onhashchange();
    this.setupTouchEvents();
    this.onresize();
  }
  
  Dz.setupParams = function() {
    var p = window.location.search.substr(1).split('&');
    p.forEach(function(e, i, a) {
      var keyVal = e.split('=');
      Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
    });
  // Specific params handling
    if (!+this.params.autoplay)
      $$.forEach($$("video"), function(v){ v.controls = true });
  }

  Dz.onkeydown = function(aEvent) {
    // Don't intercept keyboard shortcuts
    if (aEvent.altKey
      || aEvent.ctrlKey
      || aEvent.metaKey
      || aEvent.shiftKey) {
      return;
    }
    if ( aEvent.keyCode == 37 // left arrow
      || aEvent.keyCode == 38 // up arrow
      || aEvent.keyCode == 33 // page up
    ) {
      aEvent.preventDefault();
      this.back();
    }
    if ( aEvent.keyCode == 39 // right arrow
      || aEvent.keyCode == 40 // down arrow
      || aEvent.keyCode == 34 // page down
    ) {
      aEvent.preventDefault();
      this.forward();
    }
    if (aEvent.keyCode == 35) { // end
      aEvent.preventDefault();
      this.goEnd();
    }
    if (aEvent.keyCode == 36) { // home
      aEvent.preventDefault();
      this.goStart();
    }
    if (aEvent.keyCode == 32) { // space
      aEvent.preventDefault();
      this.toggleContent();
    }
    if (aEvent.keyCode == 70) { // f
      aEvent.preventDefault();
      this.goFullscreen();
    }
  }

  /* Touch Events */

  Dz.setupTouchEvents = function() {
    var orgX, newX;
    var tracking = false;

    var db = document.body;
    db.addEventListener("touchstart", start.bind(this), false);
    db.addEventListener("touchmove", move.bind(this), false);

    function start(aEvent) {
      aEvent.preventDefault();
      tracking = true;
      orgX = aEvent.changedTouches[0].pageX;
    }

    function move(aEvent) {
      if (!tracking) return;
      newX = aEvent.changedTouches[0].pageX;
      if (orgX - newX > 100) {
        tracking = false;
        this.forward();
      } else {
        if (orgX - newX < -100) {
          tracking = false;
          this.back();
        }
      }
    }
  }

  /* Adapt the size of the slides to the window */

  Dz.onresize = function() {
    var db = document.body;
    var sx = db.clientWidth / window.innerWidth;
    var sy = db.clientHeight / window.innerHeight;
    var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

    db.style.MozTransform = transform;
    db.style.WebkitTransform = transform;
    db.style.OTransform = transform;
    db.style.msTransform = transform;
    db.style.transform = transform;
  }


  Dz.getDetails = function(aIdx) {
    var s = $("section:nth-of-type(" + aIdx + ")");
    var d = s.$("details");
    return d ? d.innerHTML : "";
  }

  Dz.onmessage = function(aEvent) {
    var argv = aEvent.data.split(" "), argc = argv.length;
    argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
    var win = aEvent.source;
    if (argv[0] === "REGISTER" && argc === 1) {
      this.remoteWindows.push(win);
      this.postMsg(win, "REGISTERED", document.title, this.slides.length);
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
      return;
    }
    if (argv[0] === "BACK" && argc === 1)
      this.back();
    if (argv[0] === "FORWARD" && argc === 1)
      this.forward();
    if (argv[0] === "START" && argc === 1)
      this.goStart();
    if (argv[0] === "END" && argc === 1)
      this.goEnd();
    if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
      this.toggleContent();
    if (argv[0] === "SET_CURSOR" && argc === 2)
      window.location.hash = "#" + argv[1];
    if (argv[0] === "GET_CURSOR" && argc === 1)
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
    if (argv[0] === "GET_NOTES" && argc === 1)
      this.postMsg(win, "NOTES", this.getDetails(this.idx));
  }

  Dz.toggleContent = function() {
    // If a Video is present in this new slide, play it.
    // If a Video is present in the previous slide, stop it.
    var s = $("section[aria-selected]");
    if (s) {
      var video = s.$("video");
      if (video) {
        if (video.ended || video.paused) {
          video.play();
        } else {
          video.pause();
        }
      }
    }
  }

  Dz.setCursor = function(aIdx, aStep) {
    // If the user change the slide number in the URL bar, jump
    // to this slide.
    aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
    window.location.hash = "#" + aIdx + aStep;
  }

  Dz.onhashchange = function() {
    var cursor = window.location.hash.split("#"),
        newidx = 1,
        newstep = 0;
    if (cursor.length == 2) {
      newidx = ~~cursor[1].split(".")[0];
      newstep = ~~cursor[1].split(".")[1];
      if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
        newstep = 0;
        newidx++;
      }
    }
    this.setProgress(newidx, newstep);
    if (newidx != this.idx) {
      this.setSlide(newidx);
    }
    if (newstep != this.step) {
      this.setIncremental(newstep);
    }
    for (var i = 0; i < this.remoteWindows.length; i++) {
      this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
    }
  }

  Dz.back = function() {
    if (this.idx == 1 && this.step == 0) {
      return;
    }
    if (this.step == 0) {
      this.setCursor(this.idx - 1,
                     this.slides[this.idx - 2].$$('.incremental > *').length);
    } else {
      this.setCursor(this.idx, this.step - 1);
    }
  }

  Dz.forward = function() {
    if (this.idx >= this.slides.length &&
        this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        return;
    }
    if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      this.setCursor(this.idx + 1, 0);
    } else {
      this.setCursor(this.idx, this.step + 1);
    }
  }

  Dz.goStart = function() {
    this.setCursor(1, 0);
  }

  Dz.goEnd = function() {
    var lastIdx = this.slides.length;
    var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
    this.setCursor(lastIdx, lastStep);
  }

  Dz.setSlide = function(aIdx) {
    this.idx = aIdx;
    var old = $("section[aria-selected]");
    var next = $("section:nth-of-type("+ this.idx +")");
    if (old) {
      old.removeAttribute("aria-selected");
      var video = old.$("video");
      if (video) {
        video.pause();
      }
    }
    if (next) {
      next.setAttribute("aria-selected", "true");
      var video = next.$("video");
      if (video && !!+this.params.autoplay) {
        video.play();
      }
    } else {
      // That should not happen
      this.idx = -1;
      // console.warn("Slide doesn't exist.");
    }
  }

  Dz.setIncremental = function(aStep) {
    this.step = aStep;
    var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
    if (old) {
      old.removeAttribute('aria-selected');
    }
    var incrementals = $$('.incremental');
    if (this.step <= 0) {
      $$.forEach(incrementals, function(aNode) {
        aNode.removeAttribute('active');
      });
      return;
    }
    var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
    if (next) {
      next.setAttribute('aria-selected', true);
      next.parentNode.setAttribute('active', true);
      var found = false;
      $$.forEach(incrementals, function(aNode) {
        if (aNode != next.parentNode)
          if (found)
            aNode.removeAttribute('active');
          else
            aNode.setAttribute('active', true);
        else
          found = true;
      });
    } else {
      setCursor(this.idx, 0);
    }
    return next;
  }

  Dz.goFullscreen = function() {
    var html = $('html'),
        requestFullscreen = html.requestFullscreen || html.requestFullScreen || html.mozRequestFullScreen || html.webkitRequestFullScreen;
    if (requestFullscreen) {
      requestFullscreen.apply(html);
    }
  }
  
  Dz.setProgress = function(aIdx, aStep) {
    var slide = $("section:nth-of-type("+ aIdx +")");
    if (!slide)
      return;
    var steps = slide.$$('.incremental > *').length + 1,
        slideSize = 100 / (this.slides.length - 1),
        stepSize = slideSize / steps;
    this.progressBar.style.width = ((aIdx - 1) * slideSize + aStep * stepSize) + '%';
  }
  
  Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
    aMsg = [aMsg];
    for (var i = 2; i < arguments.length; i++)
      aMsg.push(encodeURIComponent(arguments[i]));
    aWin.postMessage(aMsg.join(" "), "*");
  }
  
  function init() {
    Dz.init();
    window.onkeydown = Dz.onkeydown.bind(Dz);
    window.onresize = Dz.onresize.bind(Dz);
    window.onhashchange = Dz.onhashchange.bind(Dz);
    window.onmessage = Dz.onmessage.bind(Dz);
  }

  window.onload = init;
</script>


<script> // Helpers
  if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {

      // closest thing possible to the ECMAScript 5 internal IsCallable
      // function 
      if (typeof this !== "function")
      throw new TypeError(
        "Function.prototype.bind - what is trying to be fBound is not callable"
      );

      var aArgs = Array.prototype.slice.call(arguments, 1),
          fToBind = this,
          fNOP = function () {},
          fBound = function () {
            return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                   aArgs.concat(Array.prototype.slice.call(arguments)));
          };

      fNOP.prototype = this.prototype;
      fBound.prototype = new fNOP();

      return fBound;
    };
  }

  var $ = (HTMLElement.prototype.$ = function(aQuery) {
    return this.querySelector(aQuery);
  }).bind(document);

  var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
    return this.querySelectorAll(aQuery);
  }).bind(document);

  $$.forEach = function(nodeList, fun) {
    Array.prototype.forEach.call(nodeList, fun);
  }

</script>
<!-- vim: set fdm=marker: }}} -->
</body>
</html>
